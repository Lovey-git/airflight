(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{LVab:function(e,t,s){"use strict";s.r(t),s.d(t,"ReportPageModule",(function(){return v}));var r=s("ofXK"),i=s("3Pt+"),n=s("TEn/"),o=s("tyNb"),a=s("mrSG"),l=s("fXoL"),c=s("hD8V"),u=s("LLt/"),d=s("T4Fs"),h=s("zEtD");function b(e,t){1&e&&l.Ib(0,"ion-icon",15)}function g(e,t){1&e&&l.Ib(0,"ion-icon",16)}function m(e,t){if(1&e){const e=l.Lb();l.Kb(0,"ion-row",9),l.Sb("click",(function(){l.cc(e);const s=t.$implicit;return l.Ub().userAlert(s.email,s.uuid)})),l.Kb(1,"ion-col"),l.Kb(2,"ion-item",6),l.fc(3,b,1,0,"ion-icon",10),l.fc(4,g,1,0,"ion-icon",11),l.Kb(5,"ion-title",12),l.gc(6),l.Jb(),l.Jb(),l.Jb(),l.Kb(7,"ion-col"),l.Kb(8,"ion-item",6),l.Kb(9,"ion-title",13),l.gc(10),l.Jb(),l.Jb(),l.Jb(),l.Kb(11,"ion-col"),l.Kb(12,"ion-item",6),l.Kb(13,"ion-title",14),l.gc(14),l.Jb(),l.Jb(),l.Jb(),l.Jb()}if(2&e){const e=t.$implicit;l.xb(3),l.Zb("ngIf",1==e.isVerified),l.xb(1),l.Zb("ngIf",0==e.isVerified),l.xb(2),l.hc(e.email),l.xb(4),l.hc(e.created_at),l.xb(4),l.hc(e.role)}}const p=[{path:"",component:(()=>{class e{constructor(e,t,s,r,i,n,o,a){this.api=e,this.authService=t,this.alertCtrl=s,this.loadingCtrl=r,this.navCtrl=i,this.router=n,this.toaster=o,this.excelService=a,this.chartType="line",this.chartTitle="Report",this.searchText="",this.count=0}ngOnInit(){this.chartData=[{data:[3,1,4,2,5],label:"Anthracnose",fill:!1}],this.chartLabels=["Jan","Feb","Mar","Apr","May"],this.chartColors=[{backgroundColor:"rgba(0, 0, 0, 0.2)",borderColor:"rgba(0, 0, 0, 1)"}]}ionViewWillEnter(){0==this.authService.isLoggedin()||"admin"!=localStorage.getItem("ur")?this.router.navigateByUrl("home"):(this.init(),this.api.get_all_users().subscribe(e=>{0==e.status?(this.users=e.data,this.count=this.users.length):this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)}))}init(){this.api.get_all_verrified_users().subscribe(e=>{0==e.status?this.verifiedUsers=e.data:this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)}),this.api.get_all_nonverrified_users().subscribe(e=>{0==e.status?this.nonVerifiedUsers=e.data:this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)}),this.api.get_all_users().subscribe(e=>{0==e.status?this.all_users=e.data:this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)}),this.searcher()}searcher(){return Object(a.a)(this,void 0,void 0,(function*(){this.api.get_all_users_by_search(this.searchText).subscribe(e=>{0==e.status?(this.users=e.data,this.count=e.data.length):this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)})}))}filterBy(e){"v"==e?(this.users=this.verifiedUsers,this.count=this.verifiedUsers.length):"n"==e?(this.users=this.nonVerifiedUsers,this.count=this.nonVerifiedUsers.length):"a"==e&&(this.users=this.all_users,this.count=this.all_users.length)}download_report(){let e="email, created_at, user_role\n";for(let i=0;i<this.users.length;i++)e+=this.users[i].email+","+this.users[i].created_at+","+this.users[i].role+"\n";const t=document.createElement("a"),s=new Blob([e],{type:"text/csv"}),r=window.URL.createObjectURL(s);t.setAttribute("target","_self"),t.setAttribute("href",r),t.setAttribute("download","report.csv"),document.body.appendChild(t),t.click(),t.remove()}download_report_pdf(){s.e(2).then(s.bind(null,"i680")).then(e=>{Promise.all([s.e(2),s.e(5)]).then(s.t.bind(null,"DaQG",7)).then(t=>{const s=new e.default("p","mm");var r=[];s.text("Number of Users: "+this.users.length,14,10),this.users.forEach(e=>{r.push([e.uuid,e.created_at,e.email,e.gender,e.province,e.role,e.isVerified])}),s.autoTable(["uuid","created_at","email","gender","province","role","isVerified"],r),s.save("report.pdf")})})}download_report_json(){const e=document.createElement("a"),t=new Blob([JSON.stringify(this.users)],{type:"data:text/json;charset=utf-8"}),s=window.URL.createObjectURL(t);e.setAttribute("target","_self"),e.setAttribute("href",s),e.setAttribute("download","report.json"),document.body.appendChild(e),e.click(),e.remove()}download_xlsx(){this.excelService.exportAsExcelFile(this.users,"report")}download_report_alert(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"Download Report",message:"Save Report as ?",buttons:[{text:"csv",handler:()=>{this.download_report()}},{text:"xlsx",handler:()=>{this.download_xlsx()}},{text:"pdf",handler:()=>{this.download_report_pdf()}},{text:"json",handler:()=>{this.download_report_json()}}]});yield e.present()}))}downloadMyFile(){const e=document.createElement("a");e.setAttribute("target","_self"),e.setAttribute("href","http://localhost:8080/download/"+JSON.stringify(this.users)),e.setAttribute("download","Ticket.pdf"),document.body.appendChild(e),e.click(),e.remove()}presentAlert(e){return Object(a.a)(this,void 0,void 0,(function*(){const t=yield this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"Warning",message:e,buttons:["OK"]});yield t.present()}))}userAlert(e,t){return Object(a.a)(this,void 0,void 0,(function*(){const s=yield this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"User :"+e,message:"",buttons:[{text:"Register as Normal User",role:"Danger",cssClass:"secondary",handler:()=>{this.register_admin(t,"normal")}},{text:"Register as Admin",handler:()=>{this.register_admin(t,"admin")}},{text:"Delete user",handler:()=>{this.delete_user(t)}},{text:"Cancel",role:"cancel"}]});yield s.present()}))}register_admin(e,t){this.api.register_as_admin(e,t).subscribe(e=>{0==e.status?(this.toaster.successToast(e.msg),this.init()):this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)})}delete_user(e){this.api.remove_user(e).subscribe(e=>{0==e.status?(this.toaster.successToast(e.msg),this.init(),this.count-=1):this.presentAlert(e.msg)},e=>{this.presentAlert(e.message)})}}return e.\u0275fac=function(t){return new(t||e)(l.Hb(c.a),l.Hb(u.a),l.Hb(n.b),l.Hb(n.K),l.Hb(n.N),l.Hb(o.g),l.Hb(d.a),l.Hb(h.a))},e.\u0275cmp=l.Bb({type:e,selectors:[["app-report"]],decls:20,vars:3,consts:[[1,"layer"],[1,"booking-form"],["value","Verified",3,"click"],["value","Non-Verified",3,"click"],["value","all",3,"click"],["showCancelButton","focus",3,"ngModel","ngModelChange"],["lines","none"],["name","save-outline","slot","end",3,"click"],["style","border-bottom: groove;",3,"click",4,"ngFor","ngForOf"],[2,"border-bottom","groove",3,"click"],["color","success","slot","","name","checkmark-circle-outline",4,"ngIf"],["color","danger","slot","","name","close-circle-outline",4,"ngIf"],[2,"text-align","left","font-size","medium"],[2,"text-align","center","font-size","medium"],[2,"text-align","right","font-size","medium"],["color","success","slot","","name","checkmark-circle-outline"],["color","danger","slot","","name","close-circle-outline"]],template:function(e,t){1&e&&(l.Kb(0,"ion-content",0),l.Kb(1,"ion-row",1),l.Kb(2,"ion-header"),l.Kb(3,"ion-segment"),l.Kb(4,"ion-segment-button",2),l.Sb("click",(function(){return t.filterBy("v")})),l.Kb(5,"ion-label"),l.gc(6,"Verified users"),l.Jb(),l.Jb(),l.Kb(7,"ion-segment-button",3),l.Sb("click",(function(){return t.filterBy("n")})),l.Kb(8,"ion-label"),l.gc(9,"Non-Verified users"),l.Jb(),l.Jb(),l.Kb(10,"ion-segment-button",4),l.Sb("click",(function(){return t.filterBy("a")})),l.Kb(11,"ion-label"),l.gc(12,"All users"),l.Jb(),l.Jb(),l.Jb(),l.Kb(13,"ion-searchbar",5),l.Sb("ngModelChange",(function(e){return t.searchText=e}))("ngModelChange",(function(){return t.searcher()})),l.Jb(),l.Jb(),l.Jb(),l.Kb(14,"div",1),l.Kb(15,"ion-list-header"),l.Kb(16,"ion-item",6),l.gc(17),l.Kb(18,"ion-icon",7),l.Sb("click",(function(){return t.download_report_alert()})),l.Jb(),l.Jb(),l.Jb(),l.fc(19,m,15,5,"ion-row",8),l.Jb(),l.Jb()),2&e&&(l.xb(13),l.Zb("ngModel",t.searchText),l.xb(4),l.ic(" Users (",t.count,") "),l.xb(2),l.Zb("ngForOf",t.users))},directives:[n.l,n.z,n.p,n.B,n.T,n.C,n.t,n.A,n.U,i.h,i.j,n.v,n.s,n.q,r.h,n.k,r.i,n.G],styles:[""]}),e})()}];let f=(()=>{class e{}return e.\u0275mod=l.Fb({type:e}),e.\u0275inj=l.Eb({factory:function(t){return new(t||e)},imports:[[o.j.forChild(p)],o.j]}),e})();var _=s("icpI");let v=(()=>{class e{}return e.\u0275mod=l.Fb({type:e}),e.\u0275inj=l.Eb({factory:function(t){return new(t||e)},imports:[[r.b,i.d,n.I,f,_.a]]}),e})()}}]);