(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"tx+c":function(t,e,s){"use strict";s.r(e),s.d(e,"BookingsPageModule",(function(){return f}));var i=s("ofXK"),o=s("3Pt+"),r=s("TEn/"),n=s("tyNb"),a=s("mrSG"),c=s("fXoL"),l=s("hD8V"),d=s("LLt/"),h=s("T4Fs"),b=s("zEtD");function u(t,e){1&t&&c.Ib(0,"ion-icon",12)}function m(t,e){if(1&t&&(c.Kb(0,"ion-row",6),c.Kb(1,"ion-col"),c.Kb(2,"ion-item",3),c.fc(3,u,1,0,"ion-icon",7),c.Kb(4,"ion-title",8),c.gc(5),c.Jb(),c.Jb(),c.Jb(),c.Kb(6,"ion-col"),c.Kb(7,"ion-item",3),c.Kb(8,"ion-title",9),c.gc(9,"Tickets: "),c.Kb(10,"ion-badge",10),c.gc(11),c.Jb(),c.Jb(),c.Jb(),c.Jb(),c.Kb(12,"ion-col"),c.Kb(13,"ion-item",3),c.Kb(14,"ion-title",11),c.gc(15),c.Jb(),c.Jb(),c.Jb(),c.Kb(16,"ion-col"),c.Kb(17,"ion-item",3),c.Kb(18,"ion-title",11),c.gc(19),c.Jb(),c.Jb(),c.Jb(),c.Jb()),2&t){const t=e.$implicit;c.xb(3),c.Zb("ngIf",1==t.isVerified),c.xb(2),c.hc(t.destination),c.xb(6),c.hc(t.tickets),c.xb(4),c.ic("R ",t.tot_amt,""),c.xb(4),c.hc(t.depart_date)}}const g=[{path:"",component:(()=>{class t{constructor(t,e,s,i,o,r,n,a){this.api=t,this.authService=e,this.alertCtrl=s,this.loadingCtrl=i,this.navCtrl=o,this.router=r,this.toaster=n,this.excelService=a,this.searchText="",this.count=0}ngOnInit(){}ionViewWillEnter(){0==this.authService.isLoggedin()||"admin"!=localStorage.getItem("ur")?this.router.navigateByUrl("home"):this.init()}init(){this.searcher()}searcher(){return Object(a.a)(this,void 0,void 0,(function*(){console.log(this.searchText),this.api.get_all_bookings(this.searchText).subscribe(t=>{0==t.status?(this.users=t.data,this.count=t.data.length):this.presentAlert(t.msg)},t=>{this.presentAlert(t.message)})}))}filterBy(t){"v"==t?(this.users=this.verifiedUsers,this.count=this.verifiedUsers.length):"n"==t?(this.users=this.nonVerifiedUsers,this.count=this.nonVerifiedUsers.length):"a"==t&&(this.users=this.all_users,this.count=this.all_users.length)}download_report(){let t="destination, tickets, tot_amt, depart_date\n";for(let o=0;o<this.users.length;o++)t+=this.users[o].tot_amt+","+this.users[o].tickets+","+this.users[o].tot_amt+","+this.users[o].depart_date+"\n";const e=document.createElement("a"),s=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(s);e.setAttribute("target","_self"),e.setAttribute("href",i),e.setAttribute("download","report.csv"),document.body.appendChild(e),e.click(),e.remove()}download_report_pdf(){s.e(2).then(s.bind(null,"i680")).then(t=>{Promise.all([s.e(2),s.e(5)]).then(s.t.bind(null,"DaQG",7)).then(e=>{const s=new t.default("p","mm");var i=[];s.text("Number of Bookings: "+this.users.length,14,10),this.users.forEach(t=>{i.push([t.destination,t.tickets,"R"+t.tot_amt,t.depart_date])}),s.autoTable(["Destination","Tickets","Total amt","Depart date"],i),s.save("report.pdf")})})}download_report_json(){const t=document.createElement("a"),e=new Blob([JSON.stringify(this.users)],{type:"data:text/json;charset=utf-8"}),s=window.URL.createObjectURL(e);t.setAttribute("target","_self"),t.setAttribute("href",s),t.setAttribute("download","report.json"),document.body.appendChild(t),t.click(),t.remove()}download_xlsx(){this.excelService.exportAsExcelFile(this.users,"report")}download_report_alert(){return Object(a.a)(this,void 0,void 0,(function*(){const t=yield this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"Download Report",message:"Save Report as ?",buttons:[{text:"csv",handler:()=>{this.download_report()}},{text:"xlsx",handler:()=>{this.download_xlsx()}},{text:"pdf",handler:()=>{this.download_report_pdf()}},{text:"json",handler:()=>{this.download_report_json()}}]});yield t.present()}))}downloadMyFile(){const t=document.createElement("a");t.setAttribute("target","_self"),t.setAttribute("href","http://localhost:8080/download/"+JSON.stringify(this.users)),t.setAttribute("download","Ticket.pdf"),document.body.appendChild(t),t.click(),t.remove()}presentAlert(t){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"Warning",message:t,buttons:["OK"]});yield e.present()}))}userAlert(t,e){return Object(a.a)(this,void 0,void 0,(function*(){const s=yield this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"User :"+t,message:"",buttons:[{text:"Register as Normal User",role:"Danger",cssClass:"secondary",handler:()=>{this.register_admin(e,"normal")}},{text:"Register as Admin",handler:()=>{this.register_admin(e,"admin")}},{text:"Delete user",handler:()=>{this.delete_user(e)}},{text:"Cancel",role:"cancel"}]});yield s.present()}))}register_admin(t,e){this.api.register_as_admin(t,e).subscribe(t=>{0==t.status?(this.toaster.successToast(t.msg),this.init()):this.presentAlert(t.msg)},t=>{this.presentAlert(t.message)})}delete_user(t){this.api.remove_user(t).subscribe(t=>{0==t.status?(this.toaster.successToast(t.msg),this.init(),this.count-=1):this.presentAlert(t.msg)},t=>{this.presentAlert(t.message)})}}return t.\u0275fac=function(e){return new(e||t)(c.Hb(l.a),c.Hb(d.a),c.Hb(r.b),c.Hb(r.K),c.Hb(r.N),c.Hb(n.g),c.Hb(h.a),c.Hb(b.a))},t.\u0275cmp=c.Bb({type:t,selectors:[["app-bookings"]],decls:10,vars:3,consts:[[1,"layer"],[1,"booking-form"],["showCancelButton","focus",3,"ngModel","ngModelChange"],["lines","none"],["name","save-outline","slot","end",3,"click"],["style","border-bottom: groove;",4,"ngFor","ngForOf"],[2,"border-bottom","groove"],["color","success","slot","","name","checkmark-circle-outline",4,"ngIf"],[2,"text-align","left","font-size","medium"],[2,"text-align","center","font-size","medium"],["color","tertiary"],[2,"text-align","right","font-size","medium"],["color","success","slot","","name","checkmark-circle-outline"]],template:function(t,e){1&t&&(c.Kb(0,"ion-content",0),c.Kb(1,"ion-row",1),c.Kb(2,"ion-header"),c.Kb(3,"ion-searchbar",2),c.Sb("ngModelChange",(function(t){return e.searchText=t}))("ngModelChange",(function(){return e.searcher()})),c.Jb(),c.Jb(),c.Jb(),c.Kb(4,"div",1),c.Kb(5,"ion-list-header"),c.Kb(6,"ion-item",3),c.gc(7),c.Kb(8,"ion-icon",4),c.Sb("click",(function(){return e.download_report_alert()})),c.Jb(),c.Jb(),c.Jb(),c.fc(9,m,20,5,"ion-row",5),c.Jb(),c.Jb()),2&t&&(c.xb(3),c.Zb("ngModel",e.searchText),c.xb(4),c.ic(" Bookings (",e.count,") "),c.xb(2),c.Zb("ngForOf",e.users))},directives:[r.l,r.z,r.p,r.A,r.U,o.h,o.j,r.v,r.s,r.q,i.h,r.k,i.i,r.G,r.d],styles:[""]}),t})()}];let p=(()=>{class t{}return t.\u0275mod=c.Fb({type:t}),t.\u0275inj=c.Eb({factory:function(e){return new(e||t)},imports:[[n.j.forChild(g)],n.j]}),t})(),f=(()=>{class t{}return t.\u0275mod=c.Fb({type:t}),t.\u0275inj=c.Eb({factory:function(e){return new(e||t)},imports:[[i.b,o.d,r.I,p]]}),t})()}}]);