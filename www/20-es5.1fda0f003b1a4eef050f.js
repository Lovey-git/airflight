!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{LVab:function(n,r,s){"use strict";s.r(r),s.d(r,"ReportPageModule",(function(){return A}));var i=s("ofXK"),o=s("3Pt+"),a=s("TEn/"),c=s("tyNb"),l=s("mrSG"),u=s("fXoL"),b=s("hD8V"),d=s("LLt/"),h=s("T4Fs"),f=s("zEtD");function m(e,t){1&e&&u.Ib(0,"ion-icon",15)}function g(e,t){1&e&&u.Ib(0,"ion-icon",16)}function p(e,t){if(1&e){var n=u.Lb();u.Kb(0,"ion-row",9),u.Sb("click",(function(){u.cc(n);var e=t.$implicit;return u.Ub().userAlert(e.email,e.uuid)})),u.Kb(1,"ion-col"),u.Kb(2,"ion-item",6),u.fc(3,m,1,0,"ion-icon",10),u.fc(4,g,1,0,"ion-icon",11),u.Kb(5,"ion-title",12),u.gc(6),u.Jb(),u.Jb(),u.Jb(),u.Kb(7,"ion-col"),u.Kb(8,"ion-item",6),u.Kb(9,"ion-title",13),u.gc(10),u.Jb(),u.Jb(),u.Jb(),u.Kb(11,"ion-col"),u.Kb(12,"ion-item",6),u.Kb(13,"ion-title",14),u.gc(14),u.Jb(),u.Jb(),u.Jb(),u.Jb()}if(2&e){var r=t.$implicit;u.xb(3),u.Zb("ngIf",1==r.isVerified),u.xb(1),u.Zb("ngIf",0==r.isVerified),u.xb(2),u.hc(r.email),u.xb(4),u.hc(r.created_at),u.xb(4),u.hc(r.role)}}var v,_,w,y=[{path:"",component:(v=function(){function n(t,r,s,i,o,a,c,l){e(this,n),this.api=t,this.authService=r,this.alertCtrl=s,this.loadingCtrl=i,this.navCtrl=o,this.router=a,this.toaster=c,this.excelService=l,this.chartType="line",this.chartTitle="Report",this.searchText="",this.count=0}var r,i,o;return r=n,(i=[{key:"ngOnInit",value:function(){this.chartData=[{data:[3,1,4,2,5],label:"Anthracnose",fill:!1}],this.chartLabels=["Jan","Feb","Mar","Apr","May"],this.chartColors=[{backgroundColor:"rgba(0, 0, 0, 0.2)",borderColor:"rgba(0, 0, 0, 1)"}]}},{key:"ionViewWillEnter",value:function(){var e=this;0==this.authService.isLoggedin()||"admin"!=localStorage.getItem("ur")?this.router.navigateByUrl("home"):(this.init(),this.api.get_all_users().subscribe((function(t){0==t.status?(e.users=t.data,e.count=e.users.length):e.presentAlert(t.msg)}),(function(t){e.presentAlert(t.message)})))}},{key:"init",value:function(){var e=this;this.api.get_all_verrified_users().subscribe((function(t){0==t.status?e.verifiedUsers=t.data:e.presentAlert(t.msg)}),(function(t){e.presentAlert(t.message)})),this.api.get_all_nonverrified_users().subscribe((function(t){0==t.status?e.nonVerifiedUsers=t.data:e.presentAlert(t.msg)}),(function(t){e.presentAlert(t.message)})),this.api.get_all_users().subscribe((function(t){0==t.status?e.all_users=t.data:e.presentAlert(t.msg)}),(function(t){e.presentAlert(t.message)})),this.searcher()}},{key:"searcher",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.api.get_all_users_by_search(this.searchText).subscribe((function(e){0==e.status?(t.users=e.data,t.count=e.data.length):t.presentAlert(e.msg)}),(function(e){t.presentAlert(e.message)}));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"filterBy",value:function(e){"v"==e?(this.users=this.verifiedUsers,this.count=this.verifiedUsers.length):"n"==e?(this.users=this.nonVerifiedUsers,this.count=this.nonVerifiedUsers.length):"a"==e&&(this.users=this.all_users,this.count=this.all_users.length)}},{key:"download_report",value:function(){for(var e="email, created_at, user_role\n",t=0;t<this.users.length;t++)e+=this.users[t].email+","+this.users[t].created_at+","+this.users[t].role+"\n";var n=document.createElement("a"),r=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(r);n.setAttribute("target","_self"),n.setAttribute("href",s),n.setAttribute("download","report.csv"),document.body.appendChild(n),n.click(),n.remove()}},{key:"download_report_pdf",value:function(){var e=this;s.e(2).then(s.bind(null,"i680")).then((function(t){Promise.all([s.e(2),s.e(5)]).then(s.t.bind(null,"DaQG",7)).then((function(n){var r=new t.default("p","mm"),s=[];r.text("Number of Users: "+e.users.length,14,10),e.users.forEach((function(e){s.push([e.uuid,e.created_at,e.email,e.gender,e.province,e.role,e.isVerified])})),r.autoTable(["uuid","created_at","email","gender","province","role","isVerified"],s),r.save("report.pdf")}))}))}},{key:"download_report_json",value:function(){var e=document.createElement("a"),t=new Blob([JSON.stringify(this.users)],{type:"data:text/json;charset=utf-8"}),n=window.URL.createObjectURL(t);e.setAttribute("target","_self"),e.setAttribute("href",n),e.setAttribute("download","report.json"),document.body.appendChild(e),e.click(),e.remove()}},{key:"download_xlsx",value:function(){this.excelService.exportAsExcelFile(this.users,"report")}},{key:"download_report_alert",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"Download Report",message:"Save Report as ?",buttons:[{text:"csv",handler:function(){n.download_report()}},{text:"xlsx",handler:function(){n.download_xlsx()}},{text:"pdf",handler:function(){n.download_report_pdf()}},{text:"json",handler:function(){n.download_report_json()}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"downloadMyFile",value:function(){var e=document.createElement("a");e.setAttribute("target","_self"),e.setAttribute("href","http://localhost:8080/download/"+JSON.stringify(this.users)),e.setAttribute("download","Ticket.pdf"),document.body.appendChild(e),e.click(),e.remove()}},{key:"presentAlert",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"Warning",message:e,buttons:["OK"]});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}}),t,this)})))}},{key:"userAlert",value:function(e,t){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,s=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertCtrl.create({cssClass:"my-custom-class",header:"Air Food \u2708\ufe0f",subHeader:"User :"+e,message:"",buttons:[{text:"Register as Normal User",role:"Danger",cssClass:"secondary",handler:function(){s.register_admin(t,"normal")}},{text:"Register as Admin",handler:function(){s.register_admin(t,"admin")}},{text:"Delete user",handler:function(){s.delete_user(t)}},{text:"Cancel",role:"cancel"}]});case 2:return r=n.sent,n.next=5,r.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"register_admin",value:function(e,t){var n=this;this.api.register_as_admin(e,t).subscribe((function(e){0==e.status?(n.toaster.successToast(e.msg),n.init()):n.presentAlert(e.msg)}),(function(e){n.presentAlert(e.message)}))}},{key:"delete_user",value:function(e){var t=this;this.api.remove_user(e).subscribe((function(e){0==e.status?(t.toaster.successToast(e.msg),t.init(),t.count-=1):t.presentAlert(e.msg)}),(function(e){t.presentAlert(e.message)}))}}])&&t(r.prototype,i),o&&t(r,o),n}(),v.\u0275fac=function(e){return new(e||v)(u.Hb(b.a),u.Hb(d.a),u.Hb(a.b),u.Hb(a.K),u.Hb(a.N),u.Hb(c.g),u.Hb(h.a),u.Hb(f.a))},v.\u0275cmp=u.Bb({type:v,selectors:[["app-report"]],decls:20,vars:3,consts:[[1,"layer"],[1,"booking-form"],["value","Verified",3,"click"],["value","Non-Verified",3,"click"],["value","all",3,"click"],["showCancelButton","focus",3,"ngModel","ngModelChange"],["lines","none"],["name","save-outline","slot","end",3,"click"],["style","border-bottom: groove;",3,"click",4,"ngFor","ngForOf"],[2,"border-bottom","groove",3,"click"],["color","success","slot","","name","checkmark-circle-outline",4,"ngIf"],["color","danger","slot","","name","close-circle-outline",4,"ngIf"],[2,"text-align","left","font-size","medium"],[2,"text-align","center","font-size","medium"],[2,"text-align","right","font-size","medium"],["color","success","slot","","name","checkmark-circle-outline"],["color","danger","slot","","name","close-circle-outline"]],template:function(e,t){1&e&&(u.Kb(0,"ion-content",0),u.Kb(1,"ion-row",1),u.Kb(2,"ion-header"),u.Kb(3,"ion-segment"),u.Kb(4,"ion-segment-button",2),u.Sb("click",(function(){return t.filterBy("v")})),u.Kb(5,"ion-label"),u.gc(6,"Verified users"),u.Jb(),u.Jb(),u.Kb(7,"ion-segment-button",3),u.Sb("click",(function(){return t.filterBy("n")})),u.Kb(8,"ion-label"),u.gc(9,"Non-Verified users"),u.Jb(),u.Jb(),u.Kb(10,"ion-segment-button",4),u.Sb("click",(function(){return t.filterBy("a")})),u.Kb(11,"ion-label"),u.gc(12,"All users"),u.Jb(),u.Jb(),u.Jb(),u.Kb(13,"ion-searchbar",5),u.Sb("ngModelChange",(function(e){return t.searchText=e}))("ngModelChange",(function(){return t.searcher()})),u.Jb(),u.Jb(),u.Jb(),u.Kb(14,"div",1),u.Kb(15,"ion-list-header"),u.Kb(16,"ion-item",6),u.gc(17),u.Kb(18,"ion-icon",7),u.Sb("click",(function(){return t.download_report_alert()})),u.Jb(),u.Jb(),u.Jb(),u.fc(19,p,15,5,"ion-row",8),u.Jb(),u.Jb()),2&e&&(u.xb(13),u.Zb("ngModel",t.searchText),u.xb(4),u.ic(" Users (",t.count,") "),u.xb(2),u.Zb("ngForOf",t.users))},directives:[a.l,a.z,a.p,a.B,a.T,a.C,a.t,a.A,a.U,o.h,o.j,a.v,a.s,a.q,i.h,a.k,i.i,a.G],styles:[""]}),v)}],x=((_=function t(){e(this,t)}).\u0275mod=u.Fb({type:_}),_.\u0275inj=u.Eb({factory:function(e){return new(e||_)},imports:[[c.j.forChild(y)],c.j]}),_),k=s("icpI"),A=((w=function t(){e(this,t)}).\u0275mod=u.Fb({type:w}),w.\u0275inj=u.Eb({factory:function(e){return new(e||w)},imports:[[i.b,o.d,a.I,x,k.a]]}),w)}}])}();